<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>alysa – Intelligent planering</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; }
    .gradient-text {
      background: linear-gradient(135deg, #0f172a 0%, #4f46e5 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
  </style>
</head>

<body class="bg-white text-slate-900 selection:bg-indigo-100">

  <!-- NAV -->
  <nav class="max-w-7xl mx-auto px-6 py-6 flex justify-between items-center">
    <a href="./" class="flex items-center">
      <img src="./alysa-logo.png" alt="alysa" class="h-8 w-auto opacity-90 hover:opacity-100 transition" />
    </a>
    <div class="space-x-8 hidden sm:block">
      <a href="#" class="text-sm font-medium text-slate-600">Demo</a>
    </div>
  </nav>

  <!-- HERO -->
  <main class="relative flex items-center justify-center min-h-[75vh] px-6 text-center">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-50/60 via-white to-white -z-10"></div>

    <section class="max-w-3xl w-full">
      <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight mb-6">
        Snabba krav. <span class="gradient-text">Omedelbart.</span>
      </h1>

      <p class="text-lg text-slate-500 mb-10">
        Ladda upp ett planerings- eller byggdokument och få strukturerad rådata redo för analys.
      </p>

      <!-- DROPZONE -->
      <div
        id="dropzone"
        class="flex flex-col items-center justify-center p-10 border-2 border-dashed border-slate-300 rounded-3xl cursor-pointer hover:border-indigo-500 transition bg-white/70"
      >
        <p class="font-medium text-slate-700">Dra in en PDF här eller klicka för att välja</p>
        <p class="text-sm text-slate-400 mt-2">Endast PDF • Lokal analys</p>
        <input id="fileInput" type="file" accept="application/pdf" class="hidden" />
      </div>

      <!-- STATUS -->
      <p id="uploadStatus" class="mt-6 text-sm text-slate-500"></p>

      <!-- DOWNLOAD JSON -->
      <button
        id="downloadJsonBtn"
        class="hidden mt-4 px-6 py-3 rounded-xl bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-500 transition"
      >
        Ladda ner JSON
      </button>
    </section>
  </main>

  <!-- SCRIPT -->
  <script>
    const API_URL = "http://127.0.0.1:8000/api/upload-pdf";

    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const status = document.getElementById("uploadStatus");
    const downloadJsonBtn = document.getElementById("downloadJsonBtn");

    let lastPdfResult = null;

    dropzone.addEventListener("click", () => fileInput.click());

    dropzone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropzone.classList.add("border-indigo-500");
    });

    dropzone.addEventListener("dragleave", () => {
      dropzone.classList.remove("border-indigo-500");
    });

    dropzone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropzone.classList.remove("border-indigo-500");
      handleFile(e.dataTransfer.files[0]);
    });

    fileInput.addEventListener("change", () => {
      handleFile(fileInput.files[0]);
    });

    function handleFile(file) {
      if (!file || file.type !== "application/pdf") {
        status.textContent = "❌ Välj en giltig PDF-fil.";
        return;
      }

      status.textContent = "⏳ Laddar upp och analyserar PDF…";
      downloadJsonBtn.classList.add("hidden");

      const formData = new FormData();
      formData.append("file", file);

      fetch(API_URL, {
        method: "POST",
        body: formData
      })
        .then(res => {
          if (!res.ok) throw new Error("Upload failed");
          return res.json();
        })
        .then(data => {
          lastPdfResult = data;

          status.textContent = `✅ Klar! ${data.page_count} sidor analyserade` +
            (data.used_ocr ? " (OCR användes)" : "");

          downloadJsonBtn.classList.remove("hidden");
          console.log("PDF result:", data);
        })
        .catch(err => {
          console.error(err);
          status.textContent = "❌ Något gick fel vid uppladdning.";
        });
    }

    downloadJsonBtn.addEventListener("click", () => {
      if (!lastPdfResult) return;

      const blob = new Blob(
        [JSON.stringify(lastPdfResult, null, 2)],
        { type: "application/json" }
      );

      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = lastPdfResult.filename.replace(".pdf", "") + "_raw.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>

</body>
</html>